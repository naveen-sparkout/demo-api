{"version":3,"sources":["../../src/config/mailer.js"],"names":["transporter","nodemailer","createTransport","apiKey","config","mailer","SENDGRID_API_KEY","sendEmail","receiverEmail","subject","templateData","template","directory","cb","rootPath","path","normalize","__dirname","winston","info","templateDir","join","fs","lstat","err","stats","isDirectory","error","email","EmailTemplate","message","from","mailerName","fromAddress","send","global","env","views","options","extension","preview","transport","receivers","name","to","locals","then","response","statusCode","statusMessage"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA,IAAIA,WAAW,GAAGC,uBAAWC,eAAX,CAA2B,oCAAmB;AAC5DC,EAAAA,MAAM,EAAEC,MAAM,CAACC,MAAP,CAAcC;AADsC,CAAnB,CAA3B,CAAlB;;;;AAIA,IAAMC,SAAS,GAAG,SAAZA,SAAY,CAACC,aAAD,EAAgBC,OAAhB,EAAyBC,YAAzB,EAAuCC,QAAvC,EAAiDC,SAAjD,EAA4DC,EAA5D,EAAmE;AACjF,MAAIC,QAAQ,GAAGC,iBAAKC,SAAL,WAAkBC,SAAlB,SAAf;;AACAC,sBAAQC,IAAR,CAAa,uBAAb,EAAsCX,aAAtC;;AAEA,MAAMY,WAAW,GAAGL,iBAAKM,IAAL,CAAUP,QAAV,EAAoB,KAApB,EAA2B,SAA3B,EAAsCF,SAAtC,EAAiD,WAAjD,EAA8D,OAA9D,EAAuED,QAAvE,CAApB;;AAEAW,iBAAGC,KAAH,CAASH,WAAT,EAAsB,UAACI,GAAD,EAAMC,KAAN,EAAgB;AAClC,QAAID,GAAG,IAAI,CAACC,KAAK,CAACC,WAAN,EAAZ,EAAiC;AAC7BR,0BAAQS,KAAR,CAAcH,GAAd;;AACA,aAAOX,EAAE,CAACW,GAAD,CAAT;AACH;;AAED,QAAMI,KAAK,GAAG,IAAIC,0BAAJ,CAAkB;AAC5BC,MAAAA,OAAO,EAAE;AAAEC,QAAAA,IAAI,YAAK3B,MAAM,CAACC,MAAP,CAAc2B,UAAnB,gBAAmC5B,MAAM,CAACC,MAAP,CAAc4B,WAAjD;AAAN,OADmB;AAE5BC,MAAAA,IAAI,EAAGC,MAAM,CAAC/B,MAAP,CAAcgC,GAAd,KAAsB,aAAvB,GAAwC,IAAxC,GAA+C,IAFzB;AAG5BC,MAAAA,KAAK,EAAE;AAAEC,QAAAA,OAAO,EAAE;AAAEC,UAAAA,SAAS,EAAE;AAAb;AAAX,OAHqB;AAI5BC,MAAAA,OAAO,EAAE,KAJmB;AAK5BC,MAAAA,SAAS,EAAEzC;AALiB,KAAlB,CAAd;AAQA,QAAI0C,SAAS,GAAG,EAAhB;AACA,QAAIhC,YAAY,CAACiC,IAAjB,EACID,SAAS,aAAMhC,YAAY,CAACiC,IAAnB,eAA4BnC,aAA5B,MAAT,CADJ,KAGIkC,SAAS,cAAOlC,aAAP,MAAT;AAEJoB,IAAAA,KAAK,CAACM,IAAN,CAAW;AACHvB,MAAAA,QAAQ,EAAES,WADP;AAEHU,MAAAA,OAAO,EAAE;AAAEc,QAAAA,EAAE,EAAEF;AAAN,OAFN;AAGHG,MAAAA,MAAM,EAAEnC;AAHL,KAAX,EAKKoC,IALL,CAKU,gBAAgB;AAAA;AAAA,UAAdC,QAAc;;AAClB7B,0BAAQC,IAAR,CAAa,gDAAb,EAA+D4B,QAAQ,CAACC,UAAxE,EAAoFD,QAAQ,CAACE,aAA7F,EAA4GP,SAA5G;;AACA,aAAO7B,EAAE,EAAT;AACH,KARL,WASWK,oBAAQS,KATnB;AAUH,GA9BD;AAgCH,CAtCD","sourcesContent":["import winston from './winston';\r\nimport nodemailer from 'nodemailer';\r\nimport fs from 'fs';\r\nimport EmailTemplate from 'email-templates';\r\nimport path from 'path';\r\nimport nodemailerSendgrid from 'nodemailer-sendgrid';\r\n\r\nlet transporter = nodemailer.createTransport(nodemailerSendgrid({\r\n    apiKey: config.mailer.SENDGRID_API_KEY\r\n}));\r\n\r\nconst sendEmail = (receiverEmail, subject, templateData, template, directory, cb) => {\r\n    let rootPath = path.normalize(`${__dirname}/..`);\r\n    winston.info(' Receiver Email => %s', receiverEmail);\r\n\r\n    const templateDir = path.join(rootPath, 'app', 'modules', directory, 'templates', 'email', template);\r\n\r\n    fs.lstat(templateDir, (err, stats) => {\r\n        if (err || !stats.isDirectory()) {\r\n            winston.error(err);\r\n            return cb(err);\r\n        }\r\n\r\n        const email = new EmailTemplate({\r\n            message: { from: `${config.mailer.mailerName} < ${config.mailer.fromAddress} >` },\r\n            send: (global.config.env === 'development') ? true : true,\r\n            views: { options: { extension: 'ejs' } },\r\n            preview: false,\r\n            transport: transporter\r\n        });\r\n\r\n        let receivers = '';\r\n        if (templateData.name)\r\n            receivers = `${templateData.name} <${receiverEmail}>`;\r\n        else\r\n            receivers = `<${receiverEmail}>`;\r\n\r\n        email.send({\r\n                template: templateDir,\r\n                message: { to: receivers },\r\n                locals: templateData\r\n            })\r\n            .then(([response]) => {\r\n                winston.info('Email has been delivered with code %s %s to %s', response.statusCode, response.statusMessage, receivers);\r\n                return cb();\r\n            })\r\n            .catch(winston.error);\r\n    });\r\n\r\n};\r\n\r\nexport {transporter};\r\nexport {sendEmail};"],"file":"mailer.js"}